<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to MazamaLocationUtils • MazamaLocationUtils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to MazamaLocationUtils">
<meta property="og:description" content="MazamaLocationUtils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MazamaLocationUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/MazamaLocationUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Developer_Style_Guide.html">Developer Style Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MazamaScience/MazamaLocationUtils/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to MazamaLocationUtils</h1>
                        <h4 data-toc-skip class="author">Jonathan
Callahan</h4>
            
            <h4 data-toc-skip class="date">2023-10-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MazamaScience/MazamaLocationUtils/blob/HEAD/vignettes/MazamaLocationUtils.Rmd" class="external-link"><code>vignettes/MazamaLocationUtils.Rmd</code></a></small>
      <div class="hidden name"><code>MazamaLocationUtils.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>This package is intended for use in data management activities
associated with fixed locations in space. The motivating fields include
air and water quality monitoring where fixed sensors report at regular
time intervals.</p>
<p>When working with environmental monitoring time series, one of the
first things you have to do is create unique identifiers for each
individual time series. In an ideal world, each environmental time
series would have both a <code>locationID</code> and a
<code>deviceID</code> that uniquely identify the specific instrument
making measurements and the physical location where measurements are
made. A unique <code>timeseriesID</code> could be produced as
<code>locationID_deviceID</code>. Metadata associated with each
<code>timeseriesID</code> would contain basic information needed for
downstream analysis including at least:</p>
<p><code>timeseriesID, locationID, deviceID, longitude, latitude, ...</code></p>
<ul>
<li>An extended time series for a mobile sensor would group by
<code>deviceID</code>.</li>
<li>Multiple sensors placed at a single location could be be grouped by
<code>locationID</code>.</li>
<li>Maps would be created using <code>longitude, latitude</code>.</li>
<li>Time series measurements would be accessed from a secondary
<code>data</code> table with <code>timeseriesID</code> column
names.</li>
</ul>
<p>Unfortunately, we are rarely supplied with a truly unique and truly
spatial <code>locationID</code>. Instead we often use
<code>deviceID</code> or an associated non-spatial identifier as a
stand-in for <code>locationID</code>.</p>
<p>Complications we have seen include:</p>
<ul>
<li>GPS-reported longitude and latitude can have <em>jitter</em> in the
fourth or fifth decimal place making it challenging to use them to
create a unique <code>locationID</code>.</li>
<li>Sensors are sometimes <em>repositioned</em> in what the scientist
considers the “same location”.</li>
<li>Data from a single sensor goes through different processing
pipelines using different identifiers and is later brought together as
two separate timeseries.</li>
<li>The spatial scale of what constitutes a “single location” depends on
the instrumentation and scientific question being asked.</li>
<li>Deriving location-based metadata from spatial datasets is
computationally intensive unless saved and identified with a unique
<code>locationID</code>.</li>
<li>Automated searches for spatial metadata occasionally produce
incorrect results because of the non-infinite resolution of spatial
datasets and must be corrected by hand.</li>
</ul>
</div>
<div class="section level2">
<h2 id="functionality">Functionality<a class="anchor" aria-label="anchor" href="#functionality"></a>
</h2>
<p>A solution to all these problems is possible if we store spatial
metadata in simple tables in a standard directory. These tables will be
referred to as <em>collections</em>. Location lookups can be performed
with geodesic distance calculations where a longitude-latitude pair is
assigned to a pre-existing <em>known location</em> if it is within
<code>distanceThreshold</code> meters of that location. These lookups
will be extremely fast.</p>
<p>If no previously <em>known location</em> is found, the relatively
slow (seconds) creation of a new <em>known location</em> metadata record
can be performed and then added to the growing collection.</p>
<p>For collections of stationary environmental monitors that only number
in the thousands, this entire <em>collection</em> can be stored as
either a <code>.rda</code> or <code>.csv</code> file and will be under a
megabyte in size making it fast to load. This small size also makes it
possible to store multiple <em>known locations</em> files, each created
with different locations and different distance thresholds to address
the needs of different scientific studies.</p>
</div>
<div class="section level2">
<h2 id="example-usage">Example Usage<a class="anchor" aria-label="anchor" href="#example-usage"></a>
</h2>
<p>The package comes with some example <em>known locations</em>
tables.</p>
<p>Lets take some metadata we have for air quality monitors in
Washington state and create a <em>known locations</em> table for
them.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"wa_airfire_meta"</span>, package <span class="op">=</span> <span class="st">"MazamaLocationUtils"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wa</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "deviceDeploymentID"    "deviceID"              "deviceType"           </span></span>
<span><span class="co">##  [4] "deviceDescription"     "deviceExtra"           "pollutant"            </span></span>
<span><span class="co">##  [7] "units"                 "dataIngestSource"      "dataIngestURL"        </span></span>
<span><span class="co">## [10] "dataIngestUnitID"      "dataIngestExtra"       "dataIngestDescription"</span></span>
<span><span class="co">## [13] "locationID"            "locationName"          "longitude"            </span></span>
<span><span class="co">## [16] "latitude"              "elevation"             "countryCode"          </span></span>
<span><span class="co">## [19] "stateCode"             "countyName"            "timezone"             </span></span>
<span><span class="co">## [22] "houseNumber"           "street"                "city"                 </span></span>
<span><span class="co">## [25] "postalCode"            "AQSID"                 "fullAQSID"            </span></span>
<span><span class="co">## [28] "address"               "deploymentType"</span></span></code></pre>
<div class="section level3">
<h3 id="creating-a-known-locations-table">Creating a Known Locations table<a class="anchor" aria-label="anchor" href="#creating-a-known-locations-table"></a>
</h3>
<p>We can create a <em>known locations</em> table for them with a
minimum 500 meter separation between distinct locations. <em>(NOTE: This
will take some time to performa all the spatial queries.)</em></p>
<p>To speed things up, we call <code><a href="../reference/table_addLocation.html">table_addLocation()</a></code> with
defaults: <code>elevationService = NULL, addressService = NULL</code>.
This avoids these slow web service requests and results in a table with
<code>NA</code> for these columns.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/MazamaLocationUtils" class="external-link">MazamaLocationUtils</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize with standard directories</span></span>
<span><span class="fu"><a href="../reference/initializeMazamaSpatialUtils.html">initializeMazamaSpatialUtils</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/setLocationDataDir.html">setLocationDataDir</a></span><span class="op">(</span><span class="st">"./data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wa_monitors_500</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/table_initialize.html">table_initialize</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/table_addLocation.html">table_addLocation</a></span><span class="op">(</span><span class="va">wa</span><span class="op">$</span><span class="va">longitude</span>, <span class="va">wa</span><span class="op">$</span><span class="va">latitude</span>, distanceThreshold <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> </span></code></pre></div>
<p>At this point, our <em>known locations</em> table contains only
automatically generated spatial metadata.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">wa_monitors_500</span>, width <span class="op">=</span> <span class="fl">75</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Rows: 78</span></span>
<span><span class="co">## Columns: 13</span></span>
<span><span class="co">## $ locationID   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "c2913q48uk", "c28f8z9xq8", "c23hfxrdne", "c2k9v9bjc…</span></span>
<span><span class="co">## $ locationName <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "us.wa_c2913q", "us.wa_c28f8z", "us.wa_c23hfx", "us.…</span></span>
<span><span class="co">## $ longitude    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -122.2852, -122.6600, -122.2233, -117.1801, -119.008…</span></span>
<span><span class="co">## $ latitude     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 48.06534, 48.29440, 47.28140, 46.72450, 46.20010, 48…</span></span>
<span><span class="co">## $ elevation    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ countryCode  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "US", "US", "US", "US", "US", "US", "US", "US", "US"…</span></span>
<span><span class="co">## $ stateCode    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "WA", "WA", "WA", "WA", "WA", "WA", "WA", "WA", "WA"…</span></span>
<span><span class="co">## $ countyName   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Snohomish", "Island", "King", "Whitman", "Walla Wal…</span></span>
<span><span class="co">## $ timezone     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "America/Los_Angeles", "America/Los_Angeles", "Ameri…</span></span>
<span><span class="co">## $ houseNumber  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ street       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</span></span>
<span><span class="co">## $ city         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Tulalip Bay", "Oak Harbor", "Auburn", "Pullman", "B…</span></span>
<span><span class="co">## $ postalCode   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "98207", "98277", "98002", "99163", "99323", "98221"…</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="merging-external-metadata">Merging external metadata<a class="anchor" aria-label="anchor" href="#merging-external-metadata"></a>
</h3>
<p>Perhaps we would like to import some of the original metadata into
our new table. This is a very common use case where non-spatial metadata
like uniform identifiers or owner information for a monitor can be
added.</p>
<p>Just to make it interesting, let’s assume that our <em>known
locations</em> table is already large and we are only providing
additional metadata for a subset of the records.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use a subset of the wa metadata</span></span>
<span><span class="va">wa_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">65</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">wa_sub</span> <span class="op">&lt;-</span> <span class="va">wa</span><span class="op">[</span><span class="va">wa_indices</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Use a generic name for the location table</span></span>
<span><span class="va">locationTbl</span> <span class="op">&lt;-</span> <span class="va">wa_monitors_500</span></span>
<span></span>
<span><span class="co"># Find the location IDs associated with our subset</span></span>
<span><span class="va">locationID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/table_getLocationID.html">table_getLocationID</a></span><span class="op">(</span></span>
<span>  <span class="va">locationTbl</span>, </span>
<span>  longitude <span class="op">=</span> <span class="va">wa_sub</span><span class="op">$</span><span class="va">longitude</span>, </span>
<span>  latitude <span class="op">=</span> <span class="va">wa_sub</span><span class="op">$</span><span class="va">latitude</span>, </span>
<span>  distanceThreshold <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now add the "AQSID" column for our subset of locations</span></span>
<span><span class="va">locationData</span> <span class="op">&lt;-</span> <span class="va">wa_sub</span><span class="op">$</span><span class="va">AQSID</span></span>
<span><span class="va">locationTbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/table_updateColumn.html">table_updateColumn</a></span><span class="op">(</span></span>
<span>  <span class="va">locationTbl</span>, </span>
<span>  columnName <span class="op">=</span> <span class="st">"AQSID"</span>, </span>
<span>  locationID <span class="op">=</span> <span class="va">locationID</span>, </span>
<span>  locationData <span class="op">=</span> <span class="va">locationData</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Lets see how we did</span></span>
<span><span class="va">locationTbl_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/table_getRecordIndex.html">table_getRecordIndex</a></span><span class="op">(</span><span class="va">locationTbl</span>, <span class="va">locationID</span><span class="op">)</span></span>
<span><span class="va">locationTbl</span><span class="op">[</span><span class="va">locationTbl_indices</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"city"</span>, <span class="st">"AQSID"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 13 × 2</span></span></span>
<span><span class="co">##    city         AQSID       </span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> Burbank      530710006   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Newport      840MM0510008</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Soap Lake    840530250003</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Shelton      530450007   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> Winthrop     530470010   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Seattle      530330030   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Cle Elum     840MM0370180</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Longview     530150015   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> Enumclaw     530330023   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Wenatchee    530070011   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> Mount Vernon 530570015   </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> White Salmon 840MM0399990</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> LaCrosse     530750005</span></span></code></pre>
<p>Very nice. We have added <code>AQSID</code> to our known locations
table for a more detailed description of each monitors’ location.</p>
</div>
<div class="section level3">
<h3 id="finding-known-locations">Finding known locations<a class="anchor" aria-label="anchor" href="#finding-known-locations"></a>
</h3>
<p>The whole point of a known locations table is to speed up access to
spatial and other metadata. Here’s how we can use it with a set of
longitudes and latitudes that are not currently in our table.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create new locations near our known locations</span></span>
<span><span class="va">lons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">wa_sub</span><span class="op">$</span><span class="va">longitude</span><span class="op">)</span> </span>
<span><span class="va">lats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/jitter.html" class="external-link">jitter</a></span><span class="op">(</span><span class="va">wa_sub</span><span class="op">$</span><span class="va">latitude</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Any known locations within 50 meters?</span></span>
<span><span class="fu"><a href="../reference/table_getNearestLocation.html">table_getNearestLocation</a></span><span class="op">(</span></span>
<span>  <span class="va">wa_monitors_500</span>,</span>
<span>  longitude <span class="op">=</span> <span class="va">lons</span>,</span>
<span>  latitude <span class="op">=</span> <span class="va">lats</span>,</span>
<span>  distanceThreshold <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Any known locations within 250 meters</span></span>
<span><span class="fu"><a href="../reference/table_getNearestLocation.html">table_getNearestLocation</a></span><span class="op">(</span></span>
<span>  <span class="va">wa_monitors_500</span>,</span>
<span>  longitude <span class="op">=</span> <span class="va">lons</span>,</span>
<span>  latitude <span class="op">=</span> <span class="va">lats</span>,</span>
<span>  distanceThreshold <span class="op">=</span> <span class="fl">250</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] NA             "Newport"      NA             NA             NA            </span></span>
<span><span class="co">##  [6] NA             NA             NA             NA             "Wenatchee"   </span></span>
<span><span class="co">## [11] "Mount Vernon" NA             NA</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How about 5000 meters?</span></span>
<span><span class="fu"><a href="../reference/table_getNearestLocation.html">table_getNearestLocation</a></span><span class="op">(</span></span>
<span>  <span class="va">wa_monitors_500</span>,</span>
<span>  longitude <span class="op">=</span> <span class="va">lons</span>,</span>
<span>  latitude <span class="op">=</span> <span class="va">lats</span>,</span>
<span>  distanceThreshold <span class="op">=</span> <span class="fl">5000</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">city</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "Burbank"      "Newport"      "Soap Lake"    "Shelton"      "Winthrop"    </span></span>
<span><span class="co">##  [6] "Seattle"      "Cle Elum"     "Longview"     "Enumclaw"     "Wenatchee"   </span></span>
<span><span class="co">## [11] "Mount Vernon" "White Salmon" "LaCrosse"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="standard-setup">Standard Setup<a class="anchor" aria-label="anchor" href="#standard-setup"></a>
</h2>
<p>Before using <strong>MazamaLocationUtils</strong> you must first
install <strong>MazamaSpatialUtils</strong> and then install core
spatial data with:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/MazamaSpatialUtils" class="external-link">MazamaSpatialUtils</a></span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/setSpatialDataDir.html" class="external-link">setSpatialDataDir</a></span><span class="op">(</span><span class="st">"~/Data/Spatial"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/installSpatialData.html" class="external-link">installSpatialData</a></span><span class="op">(</span><span class="st">"EEZCountries"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/installSpatialData.html" class="external-link">installSpatialData</a></span><span class="op">(</span><span class="st">"OSMTimezones"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/installSpatialData.html" class="external-link">installSpatialData</a></span><span class="op">(</span><span class="st">"NaturalEarthAdm1"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/installSpatialData.html" class="external-link">installSpatialData</a></span><span class="op">(</span><span class="st">"USCensusCounties"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>initializeMazamaSpatialData()</code> function by default
assumes spatial data are installed in the standard location and is just
a wrapper for:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu">MazamaSpatialUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/setSpatialDataDir.html" class="external-link">setSpatialDataDir</a></span><span class="op">(</span><span class="st">"~/Data/Spatial"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">MazamaSpatialUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/loadSpatialData.html" class="external-link">loadSpatialData</a></span><span class="op">(</span><span class="st">"EEZCountries.rda"</span><span class="op">)</span></span>
<span>  <span class="fu">MazamaSpatialUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/loadSpatialData.html" class="external-link">loadSpatialData</a></span><span class="op">(</span><span class="st">"OSMTimezones.rda"</span><span class="op">)</span></span>
<span>  <span class="fu">MazamaSpatialUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/loadSpatialData.html" class="external-link">loadSpatialData</a></span><span class="op">(</span><span class="st">"NaturalEarthAdm1.rda"</span><span class="op">)</span></span>
<span>  <span class="fu">MazamaSpatialUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/loadSpatialData.html" class="external-link">loadSpatialData</a></span><span class="op">(</span><span class="st">"USCensusCounties.rda"</span><span class="op">)</span></span></code></pre></div>
<p>Once the required datasets have been installed, the easiest way to
set things up each session is with:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/MazamaScience/MazamaLocationUtils" class="external-link">MazamaLocationUtils</a></span><span class="op">)</span></span>
<span>  <span class="fu">initializeMazamaSpatialData</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/setLocationDataDir.html">setLocationDataDir</a></span><span class="op">(</span><span class="st">"~/Data/KnownLocations"</span><span class="op">)</span></span></code></pre></div>
<p>Every time you <code><a href="../reference/table_save.html">table_save()</a></code> your location table, a
backup will be created so you can experiment without losing your work.
File sizes are pretty tiny so you don’t have to worry about filling up
your disk.</p>
<hr>
<p>Best wishes for well organized spatial metadata!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jonathan Callahan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
